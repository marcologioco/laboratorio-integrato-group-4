<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Immobiliaris</title>
    <link href="styles/style-tailwind.css" rel="stylesheet">
    <script src="js/auth-utils.js"></script>
    <script src="js/admin.js" defer></script>
    <style>
        /* Effetti Card */
        .card-admin { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-admin:hover { transform: translateY(-4px); box-shadow: 0 12px 24px -8px rgba(0, 0, 0, 0.15); }
        
        /* Foglio A4 per il contratto */
        .paper-sheet {
            background: white;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            padding: 3rem;
            min-height: 29.7cm;
            width: 21cm;
            margin: 0 auto;
            font-family: 'Times New Roman', serif;
            line-height: 1.6;
            color: #1a1a1a;
        }
        
        /* Campi contratto */
        .contract-field {
            border-bottom: 1px dashed #666;
            padding: 0 5px;
            color: #000;
            font-weight: 600;
        }

        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            .paper-sheet { box-shadow: none; margin: 0; width: 100%; }
            aside { display: none; }
        }
    </style>
</head>

<body class="bg-gray-50 font-sans text-my-black">

    <div class="min-h-screen flex flex-col lg:flex-row">

        <aside id="sidebar" class="bg-my-green-dark text-white w-full lg:w-72 flex flex-col shadow-2xl z-20 hidden lg:flex fixed lg:relative h-screen overflow-y-auto">
            
            <div class="p-8 flex flex-col items-center border-b border-white/10">
                <div class="w-20 h-20 bg-my-orange rounded-xl flex items-center justify-center text-3xl font-bold text-white shadow-lg mb-4">
                    ADM
                </div>
                <h2 id="admin-name" class="text-lg font-bold text-center">Admin</h2>
                <p id="admin-email" class="text-xs text-gray-400 mt-1 text-center"></p>
            </div>

            <nav class="flex-1 px-4 py-6 space-y-2">
                <a href="#" class="flex items-center px-4 py-3 text-white hover:bg-white/10 rounded-lg transition-colors group">
                    <span class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center mr-3 text-my-orange group-hover:bg-my-orange group-hover:text-white transition-all">üìä</span>
                    Dashboard
                </a>
                <a href="#" class="flex items-center px-4 py-3 text-gray-300 hover:bg-white/10 hover:text-white rounded-lg transition-colors group">
                    <span class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center mr-3 group-hover:bg-my-orange group-hover:text-white transition-all">üë•</span>
                    Utenti & Venditori
                </a>
                <a href="#" class="flex items-center px-4 py-3 text-gray-300 hover:bg-white/10 hover:text-white rounded-lg transition-colors group">
                    <span class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center mr-3 group-hover:bg-my-orange group-hover:text-white transition-all">üè†</span>
                    Immobili
                </a>
                <a href="#" class="flex items-center px-4 py-3 text-gray-300 hover:bg-white/10 hover:text-white rounded-lg transition-colors group">
                    <span class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center mr-3 group-hover:bg-my-orange group-hover:text-white transition-all">üìà</span>
                    Valutazioni
                </a>
                <a href="#" class="flex items-center px-4 py-3 text-gray-300 hover:bg-white/10 hover:text-white rounded-lg transition-colors group">
                    <span class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center mr-3 group-hover:bg-my-orange group-hover:text-white transition-all">üìÑ</span>
                    Contratti
                </a>
            </nav>

            <div class="p-4 border-t border-white/10">
                <a href="index.html" class="flex items-center justify-center w-full px-4 py-2 mb-2 text-gray-400 hover:text-white text-sm transition-colors">
                    ‚Üê Torna al sito
                </a>
                <a id="logout-btn" href="#" class="flex items-center justify-center w-full px-4 py-2 bg-red-500/20 text-red-300 border border-red-500/30 rounded-lg hover:bg-red-600 hover:text-white transition-all text-sm font-semibold">
                    Logout
                </a>
            </div>
        </aside>

        <main class="flex-1 flex flex-col min-h-screen p-6 lg:p-10 relative overflow-y-auto">
            
            <header class="flex justify-between items-center lg:hidden mb-6">
                <h1 class="text-2xl font-bold text-my-green-dark">Immobiliaris Admin</h1>
                <button id="mobile-menu-btn" class="p-2 bg-white rounded-lg shadow text-my-green-dark">
                    <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
                </button>
            </header>

            <button id="close-overview" class="hidden mb-6 flex items-center text-gray-500 hover:text-my-green-dark transition-colors font-semibold">
                <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>
                Torna alla Panoramica
            </button>

            <div id="overview">
                <h2 class="text-2xl font-bold text-my-black mb-8">Panoramica Attivit√†</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6">
                    <div class="card-admin bg-white p-6 rounded-2xl shadow-sm border border-gray-100 cursor-pointer group" data-type="utenti">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-3 bg-blue-50 rounded-xl text-blue-600 group-hover:bg-blue-600 group-hover:text-white transition-colors">
                                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
                            </div>
                            <span class="text-3xl font-extrabold text-my-black" id="count-utenti">-</span>
                        </div>
                        <h3 class="text-gray-500 font-medium text-sm uppercase tracking-wider">Utenti Totali</h3>
                        <p class="text-xs text-gray-400 mt-1">Gestione account cliente</p>
                    </div>

                    <div class="card-admin bg-white p-6 rounded-2xl shadow-sm border border-gray-100 cursor-pointer group" data-type="venditori">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-3 bg-orange-50 rounded-xl text-my-orange group-hover:bg-my-orange group-hover:text-white transition-colors">
                                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                            </div>
                            <span class="text-3xl font-extrabold text-my-black" id="count-venditori">-</span>
                        </div>
                        <h3 class="text-gray-500 font-medium text-sm uppercase tracking-wider">Venditori</h3>
                        <p class="text-xs text-gray-400 mt-1">Proprietari verificati</p>
                    </div>

                    <div class="card-admin bg-white p-6 rounded-2xl shadow-sm border border-gray-100 cursor-pointer group" data-type="immobili">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-3 bg-green-50 rounded-xl text-green-600 group-hover:bg-green-600 group-hover:text-white transition-colors">
                                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                            </div>
                            <span class="text-3xl font-extrabold text-my-black" id="count-immobili">-</span>
                        </div>
                        <h3 class="text-gray-500 font-medium text-sm uppercase tracking-wider">Immobili</h3>
                        <p class="text-xs text-gray-400 mt-1">In attesa o valutati</p>
                    </div>

                    <div class="card-admin bg-white p-6 rounded-2xl shadow-sm border border-gray-100 cursor-pointer group" data-type="valutazioni">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-3 bg-purple-50 rounded-xl text-purple-600 group-hover:bg-purple-600 group-hover:text-white transition-colors">
                                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                            </div>
                            <span class="text-3xl font-extrabold text-my-black" id="count-valutazioni">-</span>
                        </div>
                        <h3 class="text-gray-500 font-medium text-sm uppercase tracking-wider">Valutazioni</h3>
                        <p class="text-xs text-gray-400 mt-1">Report generati</p>
                    </div>
                </div>
            </div>

            <div id="detail-view" class="hidden animate-fade-in">
                <h2 class="text-2xl font-bold text-my-black mb-6 border-b pb-4" id="detail-title">Titolo Sezione</h2>
                <div id="detail-cards" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                    </div>
            </div>

            <div id="contracts-view" class="hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-2xl font-bold text-my-black">Gestione Contratti</h2>
                    <div class="flex gap-3">
                         <button id="btn-view-contracts" class="flex items-center px-4 py-2 bg-white border border-gray-200 text-gray-700 rounded-lg hover:bg-gray-50 transition shadow-sm">
                            <span class="mr-2">üìã</span> Lista Contratti
                        </button>
                        <button id="btn-create-contract" class="flex items-center px-4 py-2 bg-my-green-dark text-white rounded-lg hover:bg-[#111A19] transition shadow-lg shadow-green-900/20">
                            <span class="mr-2">‚ûï</span> Nuovo Contratto
                        </button>
                    </div>
                </div>
                
                <div class="bg-white p-12 rounded-2xl shadow-sm text-center border border-dashed border-gray-300">
                    <div class="text-6xl mb-4">üìÑ</div>
                    <h3 class="text-xl font-bold text-gray-800">Area Contrattuale</h3>
                    <p class="text-gray-500">Seleziona un'azione in alto per iniziare a gestire i contratti di vendita.</p>
                </div>
            </div>

            <div id="contracts-list-view" class="hidden">
                <button id="btn-back-contracts" class="mb-6 text-gray-500 hover:text-my-green-dark flex items-center font-medium">
                    ‚Üê Indietro
                </button>
                <h3 class="text-xl font-bold mb-6">Contratti Archiviati</h3>
                <div id="contracts-list" class="grid grid-cols-1 gap-4">
                    </div>
            </div>

            <div id="contract-form-view" class="hidden">
                <div class="flex justify-between items-start no-print mb-6">
                    <button id="btn-back-from-form" class="text-gray-500 hover:text-my-green-dark flex items-center font-medium">
                        ‚Üê Annulla
                    </button>
                    <div class="flex gap-3">
                        <button id="btn-preview-contract" class="px-4 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 font-semibold">
                           üëÅÔ∏è Aggiorna Anteprima
                        </button>
                        <button id="btn-save-contract" class="px-4 py-2 bg-my-green-dark text-white rounded-lg hover:bg-[#111A19] shadow-lg font-semibold">
                           üíæ Salva Definitivo
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
                    
                    <div class="xl:col-span-1 bg-white p-6 rounded-xl shadow-sm border border-gray-200 h-fit no-print">
                        <h4 class="font-bold text-lg mb-6 text-my-green-dark border-b pb-2">1. Dati Essenziali</h4>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Immobile</label>
                                <select id="select-immobile" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-my-orange focus:border-transparent bg-gray-50">
                                    <option value="">-- Seleziona --</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Venditore</label>
                                <select id="select-venditore" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-my-orange focus:border-transparent bg-gray-50">
                                    <option value="">-- Seleziona --</option>
                                </select>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Data Inizio</label>
                                    <input type="date" id="data-inizio" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Data Fine</label>
                                    <input type="date" id="data-fine" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Minimo (‚Ç¨)</label>
                                    <input type="number" id="prezzo-minimo" class="w-full border border-gray-300 rounded-lg px-3 py-2 font-mono" placeholder="0">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Comm. (%)</label>
                                    <input type="number" id="commissione" class="w-full border border-gray-300 rounded-lg px-3 py-2 font-mono" value="3" step="0.1">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 pt-6 border-t border-gray-100">
                            <button id="btn-send-contract" class="w-full py-3 bg-purple-50 text-purple-700 rounded-lg hover:bg-purple-100 font-semibold flex items-center justify-center">
                                üìß Salva e Invia Email
                            </button>
                        </div>
                    </div>

                    <div class="xl:col-span-2 bg-gray-200 p-4 rounded-xl overflow-auto flex justify-center no-print-bg">
                        
                        <div id="contract-template" class="paper-sheet">
                            
                            <div class="text-center mb-8 border-b-2 border-black pb-4">
                                <h2 class="text-2xl font-bold tracking-wider">CONTRATTO DI INCARICO IN ESCLUSIVA</h2>
                                <h3 class="text-lg italic">PER LA VENDITA DI IMMOBILE</h3>
                            </div>

                            <div class="mb-6 text-justify">
                                <p><strong>TRA</strong></p>
                                <p class="mt-2 pl-4 border-l-2 border-gray-300">
                                    Il/La Sig./Sig.ra <span class="contract-field bg-yellow-50" id="venditore-nome">____________________</span>, 
                                    C.F. <span class="contract-field" id="venditore-cf">____________________</span>,
                                    residente in <span class="contract-field" id="venditore-citta">____________________</span>, 
                                    Via <span class="contract-field" id="venditore-indirizzo">____________________</span>.
                                    <br><em>(di seguito "Venditore")</em>
                                </p>
                                <p class="mt-4"><strong>E</strong></p>
                                <p class="mt-2 pl-4 border-l-2 border-gray-300">
                                    <strong>IMMOBILIARIS S.r.l.</strong>, con sede in Torino, P.IVA 12345678901.
                                    <br><em>(di seguito "Agenzia")</em>
                                </p>
                            </div>

                            <div class="space-y-4 text-justify">
                                <div>
                                    <p class="font-bold">1. OGGETTO</p>
                                    <p>Il Venditore conferisce incarico esclusivo per la vendita dell'immobile sito in <span class="contract-field" id="immobile-citta">_______</span>, 
                                    Via <span class="contract-field" id="immobile-indirizzo">____________________</span>.</p>
                                    <p class="text-sm mt-1">
                                        Dettagli: <span class="contract-field" id="immobile-mq">___</span> mq, 
                                        <span class="contract-field" id="immobile-camere">___</span> vani, 
                                        cat. <span class="contract-field" id="immobile-tipo">___</span>.
                                    </p>
                                </div>

                                <div>
                                    <p class="font-bold">2. PREZZO E CONDIZIONI</p>
                                    <p>Il prezzo di vendita richiesto √® di <strong>‚Ç¨ <span class="contract-field text-lg" id="immobile-prezzo">0</span></strong>.</p>
                                    <p>Il Venditore accetter√† proposte non inferiori a ‚Ç¨ <span class="contract-field" id="contratto-prezzo-minimo">0</span>.</p>
                                </div>

                                <div>
                                    <p class="font-bold">3. DURATA</p>
                                    <p>Dal <span class="contract-field" id="contratto-data-inizio">__/__/____</span> al <span class="contract-field" id="contratto-data-fine">__/__/____</span>.</p>
                                </div>

                                <div>
                                    <p class="font-bold">4. PROVVIGIONE</p>
                                    <p>All'Agenzia spetta una provvigione del <strong><span class="contract-field" id="contratto-commissione">3</span>%</strong> + IVA sul prezzo finale di vendita.</p>
                                </div>
                            </div>

                            <div class="mt-16 grid grid-cols-2 gap-10">
                                <div class="text-center">
                                    <p class="text-sm text-gray-500 mb-12">Luogo e Data: <span id="firma-data">__/__/____</span></p>
                                    <div class="border-t border-black pt-2 font-bold">Il Venditore</div>
                                </div>
                                <div class="text-center">
                                    <p class="text-sm text-gray-500 mb-12">Agente Incaricato</p>
                                    <div class="border-t border-black pt-2 font-bold">Per Immobiliaris S.r.l.</div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        const mobileBtn = document.getElementById('mobile-menu-btn');
        const sidebar = document.getElementById('sidebar');
        if(mobileBtn && sidebar) {
            mobileBtn.addEventListener('click', () => {
                sidebar.classList.toggle('hidden');
                sidebar.classList.toggle('fixed');
                sidebar.classList.toggle('inset-0');
            });
        }
    </script>
</body>
</html>